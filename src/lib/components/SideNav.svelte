<script lang="ts">
	import { page } from '$app/stores';
	import NavBarButton from './NavBarButton.svelte';
	import { currentUser } from '$lib/user';
	import { Separator } from './ui/separator';
	import * as DropdownMenu from './ui/dropdown-menu';
	import { Button } from './ui/button';
	import { createEventDispatcher } from 'svelte';
	import * as Avatar from './ui/avatar';
	import { shortenText } from '$lib/utils';
	import { enhance } from '$app/forms';

	const routes = [
		{
			href: '/',
			icon: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 8.47825C2.5 7.86107 2.78495 7.27846 3.27212 6.89954L8.77212 2.62177C9.49434 2.06004 10.5057 2.06004 11.2279 2.62177L16.7279 6.89954C17.2151 7.27846 17.5 7.86107 17.5 8.47825V16.6667C17.5 17.1088 17.3244 17.5327 17.0118 17.8453C16.6993 18.1578 16.2754 18.3334 15.8333 18.3334H4.16667C3.72464 18.3334 3.30072 18.1578 2.98816 17.8453C2.67559 17.5327 2.5 17.1088 2.5 16.6667V8.47825Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7.5 18.3333V10H12.5V18.3333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			activeIcon:
				'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 8.47825C2.5 7.86107 2.78495 7.27846 3.27212 6.89954L8.77212 2.62177C9.49434 2.06004 10.5057 2.06004 11.2279 2.62177L16.7279 6.89954C17.2151 7.27846 17.5 7.86107 17.5 8.47825V16.6667C17.5 17.1088 17.3244 17.5327 17.0118 17.8453C16.6993 18.1578 16.2754 18.3334 15.8333 18.3334H4.16667C3.72464 18.3334 3.30072 18.1578 2.98816 17.8453C2.67559 17.5327 2.5 17.1088 2.5 16.6667V8.47825Z" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7.5 18.3333V10H12.5V18.3333" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			pageTitle: 'Homepage'
		},
		{
			href: '/roles',
			icon: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.9167 6.25008L15.8333 3.33341M17.5 1.66675L15.8333 3.33341L17.5 1.66675ZM9.49165 9.67508C9.92194 10.0996 10.264 10.6051 10.4981 11.1624C10.7322 11.7197 10.8538 12.3178 10.8558 12.9223C10.8579 13.5267 10.7403 14.1257 10.5099 14.6845C10.2795 15.2434 9.94087 15.7511 9.51344 16.1785C9.08601 16.606 8.57825 16.9446 8.0194 17.175C7.46055 17.4054 6.86165 17.523 6.25718 17.5209C5.65271 17.5189 5.0546 17.3973 4.49731 17.1632C3.94002 16.9291 3.43454 16.587 3.00998 16.1568C2.17509 15.2923 1.71312 14.1346 1.72356 12.9328C1.734 11.7311 2.21603 10.5815 3.06582 9.73175C3.9156 8.88196 5.06516 8.39994 6.2669 8.38949C7.46863 8.37905 8.62639 8.84102 9.49082 9.67592L9.49165 9.67508ZM9.49165 9.67508L12.9167 6.25008L9.49165 9.67508ZM12.9167 6.25008L15.4167 8.75008L18.3333 5.83342L15.8333 3.33341L12.9167 6.25008Z" stroke="currentColor" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			activeIcon:
				'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12.9167 6.25008L15.8333 3.33341M17.5 1.66675L15.8333 3.33341L17.5 1.66675ZM9.49165 9.67508C9.92194 10.0996 10.264 10.6051 10.4981 11.1624C10.7322 11.7197 10.8538 12.3178 10.8558 12.9223C10.8579 13.5267 10.7403 14.1257 10.5099 14.6845C10.2795 15.2434 9.94087 15.7511 9.51344 16.1785C9.08601 16.606 8.57825 16.9446 8.0194 17.175C7.46055 17.4054 6.86165 17.523 6.25718 17.5209C5.65271 17.5189 5.0546 17.3973 4.49731 17.1632C3.94002 16.9291 3.43454 16.587 3.00998 16.1568C2.17509 15.2923 1.71312 14.1346 1.72356 12.9328C1.734 11.7311 2.21603 10.5815 3.06582 9.73175C3.9156 8.88196 5.06516 8.39994 6.2669 8.38949C7.46863 8.37905 8.62639 8.84102 9.49082 9.67592L9.49165 9.67508ZM9.49165 9.67508L12.9167 6.25008L9.49165 9.67508ZM12.9167 6.25008L15.4167 8.75008L18.3333 5.83342L15.8333 3.33341L12.9167 6.25008Z" stroke="#DA4E45" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			pageTitle: 'Roles',
			permission: 'view_group'
		},
		{
			href: '/orders',
			icon: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.50002 18.3334C7.96026 18.3334 8.33335 17.9603 8.33335 17.5001C8.33335 17.0398 7.96026 16.6667 7.50002 16.6667C7.03978 16.6667 6.66669 17.0398 6.66669 17.5001C6.66669 17.9603 7.03978 18.3334 7.50002 18.3334Z" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M16.6666 18.3334C17.1269 18.3334 17.5 17.9603 17.5 17.5001C17.5 17.0398 17.1269 16.6667 16.6666 16.6667C16.2064 16.6667 15.8333 17.0398 15.8333 17.5001C15.8333 17.9603 16.2064 18.3334 16.6666 18.3334Z" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M0.833313 0.833252H4.16665L6.39998 11.9916C6.47618 12.3752 6.6849 12.7199 6.9896 12.9652C7.2943 13.2105 7.67556 13.3407 8.06665 13.3333H16.1666C16.5577 13.3407 16.939 13.2105 17.2437 12.9652C17.5484 12.7199 17.7571 12.3752 17.8333 11.9916L19.1666 4.99992H4.99998" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			activeIcon:
				'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.50002 18.3334C7.96026 18.3334 8.33335 17.9603 8.33335 17.5001C8.33335 17.0398 7.96026 16.6667 7.50002 16.6667C7.03978 16.6667 6.66669 17.0398 6.66669 17.5001C6.66669 17.9603 7.03978 18.3334 7.50002 18.3334Z" stroke="#DA4E45" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M16.6666 18.3334C17.1269 18.3334 17.5 17.9603 17.5 17.5001C17.5 17.0398 17.1269 16.6667 16.6666 16.6667C16.2064 16.6667 15.8333 17.0398 15.8333 17.5001C15.8333 17.9603 16.2064 18.3334 16.6666 18.3334Z" stroke="#DA4E45" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M0.833313 0.833252H4.16665L6.39998 11.9916C6.47618 12.3752 6.6849 12.7199 6.9896 12.9652C7.2943 13.2105 7.67556 13.3407 8.06665 13.3333H16.1666C16.5577 13.3407 16.939 13.2105 17.2437 12.9652C17.5484 12.7199 17.7571 12.3752 17.8333 11.9916L19.1666 4.99992H4.99998" stroke="#DA4E45" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			pageTitle: 'Orders',
			permission: 'view_order'
		},
		{
			href: '/inventory',
			icon: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.5 13.3334V6.66675C17.4997 6.37448 17.4225 6.08742 17.2763 5.83438C17.13 5.58134 16.9198 5.37122 16.6667 5.22508L10.8333 1.89175C10.58 1.74547 10.2926 1.66846 10 1.66846C9.70744 1.66846 9.42003 1.74547 9.16667 1.89175L3.33333 5.22508C3.08022 5.37122 2.86998 5.58134 2.72372 5.83438C2.57745 6.08742 2.5003 6.37448 2.5 6.66675V13.3334C2.5003 13.6257 2.57745 13.9127 2.72372 14.1658C2.86998 14.4188 3.08022 14.6289 3.33333 14.7751L9.16667 18.1084C9.42003 18.2547 9.70744 18.3317 10 18.3317C10.2926 18.3317 10.58 18.2547 10.8333 18.1084L16.6667 14.7751C16.9198 14.6289 17.13 14.4188 17.2763 14.1658C17.4225 13.9127 17.4997 13.6257 17.5 13.3334Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2.72498 5.80005L9.99998 10.0084L17.275 5.80005" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 18.4V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			activeIcon:
				'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.5 13.3334V6.66675C17.4997 6.37448 17.4225 6.08742 17.2763 5.83438C17.13 5.58134 16.9198 5.37122 16.6667 5.22508L10.8333 1.89175C10.58 1.74547 10.2926 1.66846 10 1.66846C9.70744 1.66846 9.42003 1.74547 9.16667 1.89175L3.33333 5.22508C3.08022 5.37122 2.86998 5.58134 2.72372 5.83438C2.57745 6.08742 2.5003 6.37448 2.5 6.66675V13.3334C2.5003 13.6257 2.57745 13.9127 2.72372 14.1658C2.86998 14.4188 3.08022 14.6289 3.33333 14.7751L9.16667 18.1084C9.42003 18.2547 9.70744 18.3317 10 18.3317C10.2926 18.3317 10.58 18.2547 10.8333 18.1084L16.6667 14.7751C16.9198 14.6289 17.13 14.4188 17.2763 14.1658C17.4225 13.9127 17.4997 13.6257 17.5 13.3334Z" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2.72498 5.80005L9.99998 10.0084L17.275 5.80005" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M10 18.4V10" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			pageTitle: 'Inventory',
			children: [
				{
					title: 'Products',
					href: '/inventory/products',
					color: '#FF1C0D',
					childRoutes: [{ title: 'Types', href: '/inventory/products/types/' }]
				},

				{
					title: 'Suppliers',
					href: '/inventory/suppliers',
					color: '#FF1C0D',
					permission: 'view_supplier'
				}
			]
		},

		{
			href: '/staffs',
			icon: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.1667 17.5V15.8333C14.1667 14.9493 13.8155 14.1014 13.1904 13.4763C12.5653 12.8512 11.7174 12.5 10.8334 12.5H4.16671C3.28265 12.5 2.43481 12.8512 1.80968 13.4763C1.18456 14.1014 0.833374 14.9493 0.833374 15.8333V17.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7.49996 9.16667C9.34091 9.16667 10.8333 7.67428 10.8333 5.83333C10.8333 3.99238 9.34091 2.5 7.49996 2.5C5.65901 2.5 4.16663 3.99238 4.16663 5.83333C4.16663 7.67428 5.65901 9.16667 7.49996 9.16667Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M19.1666 17.5001V15.8334C19.1661 15.0948 18.9203 14.3774 18.4678 13.7937C18.0153 13.2099 17.3817 12.793 16.6666 12.6084" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M13.3334 2.6084C14.0504 2.79198 14.6859 3.20898 15.1397 3.79366C15.5936 4.37833 15.8399 5.09742 15.8399 5.83757C15.8399 6.57771 15.5936 7.2968 15.1397 7.88147C14.6859 8.46615 14.0504 8.88315 13.3334 9.06673" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			activeIcon:
				'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.1667 17.5V15.8333C14.1667 14.9493 13.8155 14.1014 13.1904 13.4763C12.5653 12.8512 11.7174 12.5 10.8334 12.5H4.16671C3.28265 12.5 2.43481 12.8512 1.80968 13.4763C1.18456 14.1014 0.833374 14.9493 0.833374 15.8333V17.5" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7.49996 9.16667C9.34091 9.16667 10.8333 7.67428 10.8333 5.83333C10.8333 3.99238 9.34091 2.5 7.49996 2.5C5.65901 2.5 4.16663 3.99238 4.16663 5.83333C4.16663 7.67428 5.65901 9.16667 7.49996 9.16667Z" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M19.1666 17.5001V15.8334C19.1661 15.0948 18.9203 14.3774 18.4678 13.7937C18.0153 13.2099 17.3817 12.793 16.6666 12.6084" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M13.3334 2.6084C14.0504 2.79198 14.6859 3.20898 15.1397 3.79366C15.5936 4.37833 15.8399 5.09742 15.8399 5.83757C15.8399 6.57771 15.5936 7.2968 15.1397 7.88147C14.6859 8.46615 14.0504 8.88315 13.3334 9.06673" stroke="#DA4E45" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>',
			pageTitle: 'Human Resources',
			children: [
				{
					title: 'Tasks',
					href: '/hrm/tasks',
					permission: 'view_task'
				},
				{
					title: 'Staffs',
					href: '/hrm/staffs',
					permission: 'view_staffs'
				}
			]
		},
		{
			href: '/settings',
			icon: '<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_457_773)"><path d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M16.1667 12.4999C16.0558 12.7513 16.0227 13.0301 16.0717 13.3004C16.1207 13.5707 16.2496 13.8202 16.4417 14.0166L16.4917 14.0666C16.6467 14.2214 16.7696 14.4052 16.8535 14.6075C16.9373 14.8098 16.9805 15.0267 16.9805 15.2458C16.9805 15.4648 16.9373 15.6817 16.8535 15.884C16.7696 16.0863 16.6467 16.2701 16.4917 16.4249C16.3369 16.5799 16.1531 16.7028 15.9508 16.7867C15.7484 16.8706 15.5316 16.9137 15.3125 16.9137C15.0935 16.9137 14.8766 16.8706 14.6743 16.7867C14.472 16.7028 14.2882 16.5799 14.1334 16.4249L14.0834 16.3749C13.887 16.1828 13.6375 16.0539 13.3672 16.0049C13.0969 15.9559 12.8181 15.989 12.5667 16.0999C12.3202 16.2056 12.11 16.381 11.962 16.6045C11.8139 16.8281 11.7344 17.0901 11.7334 17.3583V17.4999C11.7334 17.9419 11.5578 18.3659 11.2452 18.6784C10.9327 18.991 10.5087 19.1666 10.0667 19.1666C9.62468 19.1666 9.20076 18.991 8.8882 18.6784C8.57563 18.3659 8.40004 17.9419 8.40004 17.4999V17.4249C8.39359 17.1491 8.30431 16.8816 8.1438 16.6572C7.98329 16.4328 7.75899 16.2618 7.50004 16.1666C7.24869 16.0557 6.96988 16.0226 6.69955 16.0716C6.42922 16.1206 6.17977 16.2495 5.98337 16.4416L5.93337 16.4916C5.77858 16.6465 5.59477 16.7695 5.39244 16.8533C5.19011 16.9372 4.97323 16.9804 4.75421 16.9804C4.53518 16.9804 4.3183 16.9372 4.11597 16.8533C3.91364 16.7695 3.72983 16.6465 3.57504 16.4916C3.42008 16.3368 3.29715 16.153 3.21327 15.9507C3.1294 15.7483 3.08623 15.5314 3.08623 15.3124C3.08623 15.0934 3.1294 14.8765 3.21327 14.6742C3.29715 14.4719 3.42008 14.288 3.57504 14.1332L3.62504 14.0833C3.81715 13.8869 3.94603 13.6374 3.99504 13.3671C4.04406 13.0967 4.01097 12.8179 3.90004 12.5666C3.7944 12.3201 3.619 12.1099 3.39543 11.9618C3.17185 11.8138 2.90986 11.7343 2.64171 11.7333H2.50004C2.05801 11.7333 1.63409 11.5577 1.32153 11.2451C1.00897 10.9325 0.833374 10.5086 0.833374 10.0666C0.833374 9.62456 1.00897 9.20063 1.32153 8.88807C1.63409 8.57551 2.05801 8.39992 2.50004 8.39992H2.57504C2.85087 8.39347 3.11838 8.30418 3.34279 8.14368C3.5672 7.98317 3.73814 7.75886 3.83337 7.49992C3.9443 7.24857 3.97739 6.96976 3.92838 6.69943C3.87936 6.4291 3.75049 6.17965 3.55837 5.98325L3.50837 5.93325C3.35341 5.77846 3.23048 5.59465 3.14661 5.39232C3.06273 5.18999 3.01956 4.97311 3.01956 4.75408C3.01956 4.53506 3.06273 4.31818 3.14661 4.11585C3.23048 3.91352 3.35341 3.72971 3.50837 3.57492C3.66316 3.41996 3.84698 3.29703 4.04931 3.21315C4.25164 3.12928 4.46851 3.08611 4.68754 3.08611C4.90657 3.08611 5.12344 3.12928 5.32577 3.21315C5.5281 3.29703 5.71192 3.41996 5.86671 3.57492L5.91671 3.62492C6.11311 3.81703 6.36255 3.94591 6.63288 3.99492C6.90321 4.04394 7.18203 4.01085 7.43337 3.89992H7.50004C7.74651 3.79428 7.95672 3.61888 8.10478 3.39531C8.25285 3.17173 8.3323 2.90974 8.33337 2.64159V2.49992C8.33337 2.05789 8.50897 1.63397 8.82153 1.32141C9.13409 1.00885 9.55801 0.833252 10 0.833252C10.4421 0.833252 10.866 1.00885 11.1786 1.32141C11.4911 1.63397 11.6667 2.05789 11.6667 2.49992V2.57492C11.6678 2.84307 11.7472 3.10506 11.8953 3.32864C12.0434 3.55221 12.2536 3.72762 12.5 3.83325C12.7514 3.94418 13.0302 3.97727 13.3005 3.92826C13.5709 3.87924 13.8203 3.75037 14.0167 3.55825L14.0667 3.50825C14.2215 3.35329 14.4053 3.23036 14.6076 3.14649C14.81 3.06261 15.0268 3.01944 15.2459 3.01944C15.4649 3.01944 15.6818 3.06261 15.8841 3.14649C16.0864 3.23036 16.2702 3.35329 16.425 3.50825C16.58 3.66304 16.7029 3.84685 16.7868 4.04918C16.8707 4.25151 16.9139 4.46839 16.9139 4.68742C16.9139 4.90644 16.8707 5.12332 16.7868 5.32565C16.7029 5.52798 16.58 5.7118 16.425 5.86658L16.375 5.91658C16.1829 6.11298 16.0541 6.36243 16.005 6.63276C15.956 6.90309 15.9891 7.1819 16.1 7.43325V7.49992C16.2057 7.74639 16.3811 7.9566 16.6047 8.10466C16.8282 8.25272 17.0902 8.33218 17.3584 8.33325H17.5C17.9421 8.33325 18.366 8.50885 18.6785 8.82141C18.9911 9.13397 19.1667 9.55789 19.1667 9.99992C19.1667 10.4419 18.9911 10.8659 18.6785 11.1784C18.366 11.491 17.9421 11.6666 17.5 11.6666H17.425C17.1569 11.6677 16.8949 11.7471 16.6713 11.8952C16.4477 12.0432 16.2723 12.2534 16.1667 12.4999V12.4999Z" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/></g><defs><clipPath id="clip0_457_773"><rect width="20" height="20" fill="white"/></clipPath></defs></svg>',
			activeIcon:
				'<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_457_775)"><path d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z" stroke="#DA4E45" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/><path d="M16.1667 12.4999C16.0558 12.7513 16.0227 13.0301 16.0717 13.3004C16.1207 13.5707 16.2496 13.8202 16.4417 14.0166L16.4917 14.0666C16.6467 14.2214 16.7696 14.4052 16.8535 14.6075C16.9373 14.8098 16.9805 15.0267 16.9805 15.2458C16.9805 15.4648 16.9373 15.6817 16.8535 15.884C16.7696 16.0863 16.6467 16.2701 16.4917 16.4249C16.3369 16.5799 16.1531 16.7028 15.9508 16.7867C15.7484 16.8706 15.5316 16.9137 15.3125 16.9137C15.0935 16.9137 14.8766 16.8706 14.6743 16.7867C14.472 16.7028 14.2882 16.5799 14.1334 16.4249L14.0834 16.3749C13.887 16.1828 13.6375 16.0539 13.3672 16.0049C13.0969 15.9559 12.8181 15.989 12.5667 16.0999C12.3202 16.2056 12.11 16.381 11.962 16.6045C11.8139 16.8281 11.7344 17.0901 11.7334 17.3583V17.4999C11.7334 17.9419 11.5578 18.3659 11.2452 18.6784C10.9327 18.991 10.5087 19.1666 10.0667 19.1666C9.62468 19.1666 9.20076 18.991 8.8882 18.6784C8.57563 18.3659 8.40004 17.9419 8.40004 17.4999V17.4249C8.39359 17.1491 8.30431 16.8816 8.1438 16.6572C7.98329 16.4328 7.75899 16.2618 7.50004 16.1666C7.24869 16.0557 6.96988 16.0226 6.69955 16.0716C6.42922 16.1206 6.17977 16.2495 5.98337 16.4416L5.93337 16.4916C5.77858 16.6465 5.59477 16.7695 5.39244 16.8533C5.19011 16.9372 4.97323 16.9804 4.75421 16.9804C4.53518 16.9804 4.3183 16.9372 4.11597 16.8533C3.91364 16.7695 3.72983 16.6465 3.57504 16.4916C3.42008 16.3368 3.29715 16.153 3.21327 15.9507C3.1294 15.7483 3.08623 15.5314 3.08623 15.3124C3.08623 15.0934 3.1294 14.8765 3.21327 14.6742C3.29715 14.4719 3.42008 14.288 3.57504 14.1332L3.62504 14.0833C3.81715 13.8869 3.94603 13.6374 3.99504 13.3671C4.04406 13.0967 4.01097 12.8179 3.90004 12.5666C3.7944 12.3201 3.619 12.1099 3.39543 11.9618C3.17185 11.8138 2.90986 11.7343 2.64171 11.7333H2.50004C2.05801 11.7333 1.63409 11.5577 1.32153 11.2451C1.00897 10.9325 0.833374 10.5086 0.833374 10.0666C0.833374 9.62456 1.00897 9.20063 1.32153 8.88807C1.63409 8.57551 2.05801 8.39992 2.50004 8.39992H2.57504C2.85087 8.39347 3.11838 8.30418 3.34279 8.14368C3.5672 7.98317 3.73814 7.75886 3.83337 7.49992C3.9443 7.24857 3.97739 6.96976 3.92838 6.69943C3.87936 6.4291 3.75049 6.17965 3.55837 5.98325L3.50837 5.93325C3.35341 5.77846 3.23048 5.59465 3.14661 5.39232C3.06273 5.18999 3.01956 4.97311 3.01956 4.75408C3.01956 4.53506 3.06273 4.31818 3.14661 4.11585C3.23048 3.91352 3.35341 3.72971 3.50837 3.57492C3.66316 3.41996 3.84698 3.29703 4.04931 3.21315C4.25164 3.12928 4.46851 3.08611 4.68754 3.08611C4.90657 3.08611 5.12344 3.12928 5.32577 3.21315C5.5281 3.29703 5.71192 3.41996 5.86671 3.57492L5.91671 3.62492C6.11311 3.81703 6.36255 3.94591 6.63288 3.99492C6.90321 4.04394 7.18203 4.01085 7.43337 3.89992H7.50004C7.74651 3.79428 7.95672 3.61888 8.10478 3.39531C8.25285 3.17173 8.3323 2.90974 8.33337 2.64159V2.49992C8.33337 2.05789 8.50897 1.63397 8.82153 1.32141C9.13409 1.00885 9.55801 0.833252 10 0.833252C10.4421 0.833252 10.866 1.00885 11.1786 1.32141C11.4911 1.63397 11.6667 2.05789 11.6667 2.49992V2.57492C11.6678 2.84307 11.7472 3.10506 11.8953 3.32864C12.0434 3.55221 12.2536 3.72762 12.5 3.83325C12.7514 3.94418 13.0302 3.97727 13.3005 3.92826C13.5709 3.87924 13.8203 3.75037 14.0167 3.55825L14.0667 3.50825C14.2215 3.35329 14.4053 3.23036 14.6076 3.14649C14.81 3.06261 15.0268 3.01944 15.2459 3.01944C15.4649 3.01944 15.6818 3.06261 15.8841 3.14649C16.0864 3.23036 16.2702 3.35329 16.425 3.50825C16.58 3.66304 16.7029 3.84685 16.7868 4.04918C16.8707 4.25151 16.9139 4.46839 16.9139 4.68742C16.9139 4.90644 16.8707 5.12332 16.7868 5.32565C16.7029 5.52798 16.58 5.7118 16.425 5.86658L16.375 5.91658C16.1829 6.11298 16.0541 6.36243 16.005 6.63276C15.956 6.90309 15.9891 7.1819 16.1 7.43325V7.49992C16.2057 7.74639 16.3811 7.9566 16.6047 8.10466C16.8282 8.25272 17.0902 8.33218 17.3584 8.33325H17.5C17.9421 8.33325 18.366 8.50885 18.6785 8.82141C18.9911 9.13397 19.1667 9.55789 19.1667 9.99992C19.1667 10.4419 18.9911 10.8659 18.6785 11.1784C18.366 11.491 17.9421 11.6666 17.5 11.6666H17.425C17.1569 11.6677 16.8949 11.7471 16.6713 11.8952C16.4477 12.0432 16.2723 12.2534 16.1667 12.4999V12.4999Z" stroke="#DA4E45" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/></g><defs><clipPath id="clip0_457_775"><rect width="20" height="20" fill="white"/></clipPath></defs></svg>',
			pageTitle: 'Settings'
		}
	];

	let currUrl = $page.url.pathname;

	$: {
		currUrl = $page.url.pathname;
	}

	const dispatch = createEventDispatcher();
</script>

<aside
	class="side-nav w-full max-w-64 sticky top-0 h-screen overflow-scroll no-scrollbar hidden lg:flex flex-col gap-5 bg-black-100 text-white"
>
	<div class="sidebar-logo flex flex-col items-start mb-10 px-5 pt-10">
		<h3 class="text-center text-sm font-bold text-primary-50">Spek-n-Bonnen</h3>
		<sub class=" text-center text-[0.5rem] tracking-[0.125rem]">ERP SYSTEM</sub>
	</div>
	<nav class="sidebar-nav w-full h-full flex flex-col items-start justify-between gap-4 mb-4">
		<ol class="w-full flex items-start flex-col gap-3 px-3">
			{#each routes as route}
				<NavBarButton active={$page.url.pathname === route.href} hidden={false} {route} />
			{/each}
		</ol>

		<div class="w-full mb-5">
			<Separator />
			<section class="w-full px-1">
				<div
					class="hover:bg-white/20 cursor-default hover:text-white text-grey-200 py-2 rounded px-2 w-full flex items-center mt-5"
				>
					<button
						on:click={() => dispatch('showSwitch')}
						class="w-full flex gap-2 items-center mr-auto"
					>
						<Avatar.Root>
							<Avatar.Image
								class="w-full h-full object-cover"
								loading="eager"
								src={$currentUser?.staff_profile?.profile_picture?.image ?? '/icons/human.jpg'}
								alt="user icon"
							/>
							<!-- <Avatar.Fallback class="bg-white">
								<span class="text-base font-satoshi font-medium">
									{`${$currentUser?.first_name[0]}${$currentUser?.last_name[0]}`}
								</span>
							</Avatar.Fallback> -->
						</Avatar.Root>
						<p class="text-sm">
							{#if $currentUser?.staff_profile}
								{shortenText($currentUser.staff_profile.preferred_name)}
							{:else}
								{$currentUser?.email}
							{/if}
						</p>
					</button>
					<DropdownMenu.Root>
						<!-- <button class=" px-1.5 flex justify-center items-center">
						<iconify-icon icon="pepicons-pencil:dots-y" style="color: #6b6b6b;" width="30"></iconify-icon>
					</button> -->

						<DropdownMenu.Trigger asChild let:builder>
							<Button
								builders={[builder]}
								class=" text-grey-200 p-0 flex justify-center items-center"
							>
								<iconify-icon icon="pepicons-pencil:dots-y" width="30"></iconify-icon></Button
							>
						</DropdownMenu.Trigger>
						<DropdownMenu.Content class="py-3 px-1 gap-2 flex flex-col justify-start">
							<DropdownMenu.Item
								on:click={() => dispatch('showSwitch')}
								class="w-full text-grey-100 font-satoshi cursor-pointer -tracking-[0.14px]  flex items-center justify-start py-2 h-auto rounded gap-2"
							>
								<iconify-icon icon="fluent-mdl2:switch-user" width="20"></iconify-icon>
								<span class="">Switch accounts</span>
							</DropdownMenu.Item>

							<DropdownMenu.Item
								class="text-grey-100 w-full cursor-pointer font-satoshi  -tracking-[0.14px]  flex items-center justify-start  rounded gap-2"
							>
								<form
									action="/?/logout"
									use:enhance={() => {
										console.log('test');
									}}
									class="w-full"
									method="post"
								>
									<input type="text" class="hidden" bind:value={currUrl} name="currUrl" />
									<button type="submit" class=" w-full flex py-2 items-center gap-2">
										<iconify-icon icon="material-symbols:logout" width="20"></iconify-icon>

										<span class="">Logout </span>
									</button>
								</form>
							</DropdownMenu.Item>
						</DropdownMenu.Content>
					</DropdownMenu.Root>
				</div>
			</section>
		</div>
	</nav>
</aside>

<nav
	class="w-screen flex lg:hidden items-center justify-center z-50 fixed bottom-3 md:bottom-5 right-0"
>
	<ol
		class="w-[95%] sm:w-[80%] md:w-[60%] h-10 bg-black-100 flex items-center justify-between px-3 py-6 rounded-full shadow-md"
	>
		{#each routes as route}
			{#if route.pageTitle !== 'Orders'}
				<NavBarButton
					hidden={false}
					{route}
					active={routes.indexOf(route) !== 0
						? $page.url.pathname.startsWith(route.href)
						: $page.url.pathname === route.href}
				/>
			{:else if route.pageTitle === 'Orders'}
				<NavBarButton
					{route}
					hidden={false}
					active={$page.url.pathname.startsWith(route.href)}
					alert={true}
				/>
			{/if}
		{/each}
	</ol>
</nav>
